language: c
script: sudo make install
branches:
  only:
  - master
matrix:
  include:
    - compiler: clang
    - compiler: gcc
    - env: TARGET=win WIN_TOOL=i686-w64-mingw32
    - env: TARGET=win WIN_TOOL=x86_64-w64-mingw32
  allow_failures:
    - env: TARGET=win WIN_TOOL=i686-w64-mingw32
    - env: TARGET=win WIN_TOOL=x86_64-w64-mingw32
before_install:
    - if [ ${TRAVIS_OS_NAME} = linux ]; then sudo apt-get update -qq; sudo apt-get install doxygen libpcap-dev; fi
    - if [ ${TRAVIS_OS_NAME} = osx ]; then brew update; brew install doxygen; fi
    - if   [ "${WIN_TOOL}" == i686-w64-mingw32 ]; then sudo apt-get -qq install mingw-w64 mingw-w64-tools binutils-mingw-w64-i686 gcc-mingw-w64-i686 doxygen; fi
    - if   [ "${WIN_TOOL}" == x86_64-w64-mingw32 ]; then sudo apt-get -qq install mingw-w64 mingw-w64-tools binutils-mingw-w64-i686 gcc-mingw-w64-i686 doxygen; fi
install:
  - if [ $TRAVIS_OS_NAME == linux ]; then cd libnet && ../Prepare && ../Build; fi
  - if [ $TRAVIS_OS_NAME == osx ]; then cd libnet && ../Prepare && ../Build; fi
  - if [ "${WIN_TOOL}" == i686-w64-mingw32 ]; then 
       wget http://www.winpcap.org/install/bin/WpdPack_4_1_2.zip;
       unzip WpdPack_4_1_2.zip;
       cp WpdPack/Lib/wpcap.lib /usr/i686-w64-mingw32/lib;
       cp WpdPack/Lib/Packet.lib /usr/i686-w64-mingw32/lib;
       cd libnet && ./autogen.sh && ./configure --host=i686-w64-mingw32 --prefix=/usr/i686-w64-mingw32/ && make -C doc doc && make; fi
  - if [ "${WIN_TOOL}" == x86_64-w64-mingw32 ]; then 
       wget http://www.winpcap.org/install/bin/WpdPack_4_1_2.zip;
       unzip WpdPack_4_1_2.zip;
       cp WpdPack/Lib/x64/Packet.lib /usr/x86_64-w64-mingw32/lib
       cp WpdPack/Lib/x64/wpcap.lib /usr/x86_64-w64-mingw32/lib
       cd libnet && ./autogen.sh && ./configure --host=x86_64-w64-mingw32 --prefix=/usr/x86_64-w64-mingw32/ && make -C doc doc && make; fi
#add email if you want to get notified
#notifications:
#  email:
#    on_success: change
#    on_failure: change